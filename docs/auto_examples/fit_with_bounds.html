

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fit Using Bounds &mdash; pySpecData 0.9.5.3.2 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery_custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quantitative ESR" href="QESR.html" />
    <link rel="prev" title="Plot Container" href="plot_container.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> pySpecData
          

          
          </a>

          
            
            
              <div class="version">
                0.9.5.3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">List of Modules and Sub-Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebook.html">LaTeX Notebook Functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nddata.html">ND-Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fitdata.html">the fitdata class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../figlist.html">The Figure List</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Units</a></li>
</ul>
<p class="caption"><span class="caption-text">Example Gallery</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PySpecData Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Cary_simple.html">Simple Cary UV-Vis loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="polyfit.html">Polynomial Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="esr_example.html">Bruker cw ESR Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="ppm_example.html">ppm Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="image_plot.html">Plotting Routines</a></li>
<li class="toctree-l2"><a class="reference internal" href="ellmans.html">Manipulation of UV-Vis data</a></li>
<li class="toctree-l2"><a class="reference internal" href="fit_fake_data.html">Fitting Data (Nonlinear + Symbolic)</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_example.html">Basic Slicing/Filtering Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_container.html">Plot Container</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Fit Using Bounds</a></li>
<li class="toctree-l2"><a class="reference internal" href="QESR.html">Quantitative ESR</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#individual-functions">Individual Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#matplotlib-examples">Matplotlib Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#text-only-examples">Text-Only Examples</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pySpecData</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">PySpecData Examples</a> &raquo;</li>
        
      <li>Fit Using Bounds</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/auto_examples/fit_with_bounds.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-fit-with-bounds-py"><span class="std std-ref">here</span></a>     to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="fit-using-bounds">
<span id="sphx-glr-auto-examples-fit-with-bounds-py"></span><h1>Fit Using Bounds<a class="headerlink" href="#fit-using-bounds" title="Permalink to this headline">¶</a></h1>
<p>Adapt one of the examples from lmfit to use sympy and pyspecdata.
Eventually, we want to use parts of this in the base library, so we don’t have
to retype them every time.</p>
<img alt="fit with bounds" class="sphx-glr-single-img" src="../_images/sphx_glr_fit_with_bounds_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>----------  logging output to C:\Users\johnf\pyspecdata.0.log  ----------
--&gt; fit_with_bounds.py(78):pyspecdata.core        gen_from_expr 2021-10-20 20:59:09,050
INFO: fit param --- period
--&gt; fit_with_bounds.py(78):pyspecdata.core        gen_from_expr 2021-10-20 20:59:09,051
INFO: fit param --- decay
--&gt; fit_with_bounds.py(78):pyspecdata.core        gen_from_expr 2021-10-20 20:59:09,051
INFO: fit param --- A
--&gt; fit_with_bounds.py(78):pyspecdata.core        gen_from_expr 2021-10-20 20:59:09,051
INFO: fit param --- shift
--&gt; fit_with_bounds.py(79):pyspecdata.core        gen_from_expr 2021-10-20 20:59:09,051
INFO: Parameters([(&#39;period&#39;, &lt;Parameter &#39;period&#39;, value=2, bounds=[-inf:10]&gt;), (&#39;decay&#39;, &lt;Parameter &#39;decay&#39;, value=0.02, bounds=[0.0:0.1]&gt;), (&#39;A&#39;, &lt;Parameter &#39;A&#39;, value=13.0, bounds=[0.0:20]&gt;), (&#39;shift&#39;, &lt;Parameter &#39;shift&#39;, value=0.0, bounds=[-1.5707963267948966:1.5707963267948966]&gt;)])
--&gt; fit_with_bounds.py(126):pyspecdata.core             &lt;module&gt; 2021-10-20 20:59:09,058
INFO: p_true is: Parameters([(&#39;A&#39;, &lt;Parameter &#39;A&#39;, value=14.0, bounds=[-inf:inf]&gt;), (&#39;period&#39;, &lt;Parameter &#39;period&#39;, value=5.4321, bounds=[-inf:inf]&gt;), (&#39;shift&#39;, &lt;Parameter &#39;shift&#39;, value=0.12345, bounds=[-inf:inf]&gt;), (&#39;decay&#39;, &lt;Parameter &#39;decay&#39;, value=0.01, bounds=[-inf:inf]&gt;)])
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 90
    # data points      = 1500
    # variables        = 4
    chi-square         = 11354.6062
    reduced chi-square = 7.58997740
    Akaike info crit   = 3044.23758
    Bayesian info crit = 3065.49046
[[Variables]]
    period:  5.42001504 +/- 0.01376177 (0.25%) (init = 2), model_value = 5.4321
    decay:   0.00979390 +/- 1.9852e-04 (2.03%) (init = 0.02), model_value = 0.01
    A:       13.8601431 +/- 0.24258034 (1.75%) (init = 13), model_value = 14
    shift:   0.12600174 +/- 0.02404378 (19.08%) (init = 0), model_value = 0.12345
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(period, shift) =  0.800
    C(decay, A)      =  0.576
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">random</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">sin</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">lmfit</span> <span class="kn">import</span> <span class="n">Parameters</span><span class="p">,</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">lmfit.printfuncs</span> <span class="kn">import</span> <span class="n">report_fit</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyspecdata</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">init_logging</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">15816</span><span class="p">)</span>
<span class="c1"># {{{ helper function(s)</span>
<span class="k">class</span> <span class="nc">myfitclass</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expression</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">gen_from_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span> <span class="n">guesses</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;generate parameter descriptions and a numpy (lambda) function from a sympy expresssion</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        expr: sympy expression</span>
<span class="sd">        data: nddata</span>
<span class="sd">            An nddata that has the same dimension labels as your data (or the data</span>
<span class="sd">            itself).</span>
<span class="sd">            This is not manipulated, and is needed to determine which symbols in</span>
<span class="sd">            expr correspond to dimension names.</span>
<span class="sd">        guesses: dict</span>
<span class="sd">            dictionary of keyword arguments for guesses (value) or constraints</span>
<span class="sd">            (min/max)</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        pars: lmfit.Parameters</span>
<span class="sd">        fn: function</span>
<span class="sd">            the fit function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># {{{ decide which symbols are parameters vs. variables</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;what expression are you fitting with??&quot;</span><span class="p">)</span>
        <span class="n">all_symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">)</span>
        <span class="n">axis_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dimlabels</span><span class="p">])</span>
        <span class="n">variable_symbols</span> <span class="o">=</span> <span class="n">axis_names</span> <span class="o">&amp;</span> <span class="n">all_symbols</span>
        <span class="n">parameter_symbols</span> <span class="o">=</span> <span class="n">all_symbols</span> <span class="o">-</span> <span class="n">variable_symbols</span>
        <span class="n">variable_symbols</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">variable_symbols</span><span class="p">)</span>
        <span class="n">variable_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">variable_symbols</span><span class="p">])</span>
        <span class="n">parameter_symbols</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parameter_symbols</span><span class="p">)</span>
        <span class="n">parameter_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">parameter_symbols</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="n">strm</span><span class="p">(</span>
                <span class="s2">&quot;all symbols are&quot;</span><span class="p">,</span>
                <span class="n">all_symbols</span><span class="p">,</span>
                <span class="s2">&quot;axis names are&quot;</span><span class="p">,</span>
                <span class="n">axis_names</span><span class="p">,</span>
                <span class="s2">&quot;variable names are&quot;</span><span class="p">,</span>
                <span class="n">variable_names</span><span class="p">,</span>
                <span class="s2">&quot;parameter names are&quot;</span><span class="p">,</span>
                <span class="n">parameter_names</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># }}}</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">this_name</span> <span class="ow">in</span> <span class="n">parameter_names</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">this_name</span> <span class="ow">in</span> <span class="n">guesses</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">strm</span><span class="p">(</span><span class="s2">&quot;applying bounds for&quot;</span><span class="p">,</span> <span class="n">this_name</span><span class="p">))</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">guesses</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">this_name</span><span class="p">)])</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">this_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">strm</span><span class="p">(</span><span class="s2">&quot;fit param ---&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">strm</span><span class="p">(</span><span class="n">pars</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span>
            <span class="n">variable_symbols</span> <span class="o">+</span> <span class="n">parameter_symbols</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="p">,</span>
            <span class="n">modules</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;ImmutableMatrix&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">},</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="s2">&quot;scipy&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">pars</span>


    <span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="s2">&quot;calculate the residual OR if data is None, return fake data&quot;</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;shift&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">sign</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span> <span class="o">*</span> <span class="n">pi</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="o">.</span><span class="n">valuesdict</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model</span>
        <span class="k">return</span> <span class="n">model</span> <span class="o">-</span> <span class="n">data</span>


<span class="c1"># }}}</span>
<span class="n">thisfit</span> <span class="o">=</span> <span class="n">myfitclass</span><span class="p">()</span>
<span class="c1"># {{{ a lot of what&#39;s below depends on knowing what the shape and dimension labels of my data are, so define that here</span>
<span class="n">x_vals</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">1500</span><span class="p">)</span>
<a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_data</span></a></a> <span class="o">=</span> <a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class"><span class="n">nddata</span></a></a><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># }}}</span>
<span class="c1"># {{{making sympy expression</span>
<span class="n">A</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">decay</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;A shift period decay x&quot;</span><span class="p">)</span>
<span class="n">thisfit</span><span class="o">.</span><span class="n">expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">sp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="n">period</span><span class="p">)</span> <span class="o">*</span> <span class="n">sp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">*</span> <span class="n">decay</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">fit_params</span> <span class="o">=</span> <span class="n">thisfit</span><span class="o">.</span><span class="n">gen_from_expr</span><span class="p">(</span>
    <a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_data</span></a></a><span class="p">,</span>
    <span class="n">guesses</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">13.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
        <span class="s2">&quot;shift&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span>
        <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
        <span class="s2">&quot;decay&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.00</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="c1"># }}}</span>


<span class="c1"># {{{ nddata to generate the fake data</span>
<span class="c1"># {{{ create the &quot;true&quot; parameters for the fake data</span>
<span class="n">true_values</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="mf">14.0</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="mf">5.4321</span><span class="p">,</span> <span class="s2">&quot;shift&quot;</span><span class="p">:</span> <span class="mf">0.12345</span><span class="p">,</span> <span class="s2">&quot;decay&quot;</span><span class="p">:</span> <span class="mf">0.01000</span><span class="p">}</span>
<span class="n">p_true</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">true_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">p_true</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">strm</span><span class="p">(</span><span class="s2">&quot;p_true is:&quot;</span><span class="p">,</span> <span class="n">p_true</span><span class="p">))</span>
<span class="c1"># }}}</span>
<a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mydata</span></a></a> <span class="o">=</span> <a href="../pyspecdata.html#pyspecdata.nddata.copy" title="pyspecdata.nddata.copy" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><a href="../pyspecdata.html#pyspecdata.nddata.copy" title="pyspecdata.nddata.copy" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><span class="n">empty_data</span><span class="o">.</span><span class="n">copy</span></a></a><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mydata</span></a></a><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">thisfit</span><span class="o">.</span><span class="n">residual</span><span class="p">(</span><span class="n">p_true</span><span class="p">,</span> <a href="../auto_api/pyspecdata.html#pyspecdata.nddata.getaxis" title="pyspecdata.nddata.getaxis" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><a href="../auto_api/pyspecdata.html#pyspecdata.nddata.getaxis" title="pyspecdata.nddata.getaxis" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><span class="n">mydata</span><span class="o">.</span><span class="n">getaxis</span></a></a><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">))</span>
<a href="../pyspecdata.html#pyspecdata.nddata.add_noise" title="pyspecdata.nddata.add_noise" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><a href="../pyspecdata.html#pyspecdata.nddata.add_noise" title="pyspecdata.nddata.add_noise" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><span class="n">mydata</span><span class="o">.</span><span class="n">add_noise</span></a></a><span class="p">(</span><span class="mf">2.8</span><span class="p">)</span>
<span class="c1"># }}}</span>
<span class="c1"># {{{ nddata of the guess</span>
<a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">guess</span></a></a> <span class="o">=</span> <a href="../pyspecdata.html#pyspecdata.nddata.copy" title="pyspecdata.nddata.copy" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><a href="../pyspecdata.html#pyspecdata.nddata.copy" title="pyspecdata.nddata.copy" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><span class="n">empty_data</span><span class="o">.</span><span class="n">copy</span></a></a><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">guess</span></a></a><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">thisfit</span><span class="o">.</span><span class="n">residual</span><span class="p">(</span><span class="n">fit_params</span><span class="p">,</span> <a href="../auto_api/pyspecdata.html#pyspecdata.nddata.getaxis" title="pyspecdata.nddata.getaxis" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><a href="../auto_api/pyspecdata.html#pyspecdata.nddata.getaxis" title="pyspecdata.nddata.getaxis" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><span class="n">empty_data</span><span class="o">.</span><span class="n">getaxis</span></a></a><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">))</span>
<span class="c1"># }}}</span>
<span class="c1"># {{{ run the fit and generate nddata</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
    <span class="n">thisfit</span><span class="o">.</span><span class="n">residual</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><a href="../auto_api/pyspecdata.html#pyspecdata.nddata.getaxis" title="pyspecdata.nddata.getaxis" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><a href="../auto_api/pyspecdata.html#pyspecdata.nddata.getaxis" title="pyspecdata.nddata.getaxis" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><span class="n">mydata</span><span class="o">.</span><span class="n">getaxis</span></a></a><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),),</span> <span class="n">kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mydata</span></a></a><span class="o">.</span><span class="n">data</span><span class="p">}</span>
<span class="p">)</span>
<a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fit</span></a></a> <span class="o">=</span> <a href="../pyspecdata.html#pyspecdata.nddata.copy" title="pyspecdata.nddata.copy" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><a href="../pyspecdata.html#pyspecdata.nddata.copy" title="pyspecdata.nddata.copy" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><span class="n">empty_data</span><span class="o">.</span><span class="n">copy</span></a></a><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fit</span></a></a><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">thisfit</span><span class="o">.</span><span class="n">residual</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <a href="../auto_api/pyspecdata.html#pyspecdata.nddata.getaxis" title="pyspecdata.nddata.getaxis" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><a href="../auto_api/pyspecdata.html#pyspecdata.nddata.getaxis" title="pyspecdata.nddata.getaxis" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-method"><span class="n">empty_data</span><span class="o">.</span><span class="n">getaxis</span></a></a><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">))</span>
<span class="c1"># }}}</span>

<span class="c1"># {{{ report the fit and generate the plot</span>
<span class="n">report_fit</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">show_correl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">modelpars</span><span class="o">=</span><span class="n">p_true</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mydata</span></a></a><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fit</span></a></a><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="../pyspecdata.html#id0" title="pyspecdata.nddata" class="sphx-glr-backref-module-pyspecdata sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">guess</span></a></a><span class="p">,</span> <span class="s2">&quot;g--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;guess&quot;</span><span class="p">)</span>
<span class="c1"># }}}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  1.002 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-fit-with-bounds-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/c3b844a4d84db29297cc6fb3cb4b0b77/fit_with_bounds.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">fit_with_bounds.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/41c885f8e59d0c5bb137890eed99a383/fit_with_bounds.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">fit_with_bounds.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="QESR.html" class="btn btn-neutral float-right" title="Quantitative ESR" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plot_container.html" class="btn btn-neutral float-left" title="Plot Container" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016, John M. Franck

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>