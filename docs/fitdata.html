<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>the lmfitdata class &#8212; pySpecData 0.9.5.3.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=832af5b0" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=2b30a6e6" />
    <script src="_static/documentation_options.js?v=5b73e601"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="List of Modules and Sub-Packages" href="modules.html" />
    <link rel="prev" title="Fourier Functions" href="fourier.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="the-lmfitdata-class">
<h1>the lmfitdata class<a class="headerlink" href="#the-lmfitdata-class" title="Link to this heading">¶</a></h1>
<p>This is a child class of nddata used for fitting.</p>
<p>It works with two other very useful packages
lmfit – which does a very good job of setting
up bounded fits – and sympy – which we can use
to represent the function that we are fitting.</p>
<p>Bounds improve the likelihood that our fit will converge,
while the symbolic representation both helps us to
generate latex representations of the function that we are fitting
and to <em>improve performance and error estimates</em> by automatically
calculating the jacobian.</p>
<p>You simply wrap your existing nddata with <cite>lmfitdata</cite>, set the
<cite>functional_form</cite> property to the equation you want to fit,
and provide guesses and bounds with <cite>set_guess</cite>.
The easiest way to get started is to just see the fitting examples in
the example gallery.</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyspecdata.lmfitdata.</span></span><span class="sig-name descname"><span class="pre">lmfitdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata" title="Link to this definition">¶</a></dt>
<dd><p>Inherits from an nddata and enables curve fitting through use of a sympy expression.</p>
<p>The user creates a lmfitdata class object from an existing nddata
class object, and on this lmfitdata object can define the
<a class="reference internal" href="auto_api/pyspecdata.html#pyspecdata.lmfitdata.functional_form" title="pyspecdata.lmfitdata.functional_form"><code class="xref py py-func docutils literal notranslate"><span class="pre">functional_form()</span></code></a> of the curve it would like to fit to the
data of the original nddata.
This functional form must be provided as a sympy expression, with
one of its variables matching the name of the dimension that the
user would like to fit to.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.copy">
<span class="sig-name descname"><span class="pre">copy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.copy" title="Link to this definition">¶</a></dt>
<dd><p>Return a full copy of this instance.</p>
<p>Because methods typically change the data in place, you might want to
use this frequently.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<em>boolean</em>) – <p>Default to True.
False doesn’t copy the data – this is for internal use,
<em>e.g.</em> when you want to copy all the metadata and perform a
calculation on the data.</p>
<p>The code for this also provides the definitive list of the
nddata metadata.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.eval">
<span class="sig-name descname"><span class="pre">eval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">taxis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.eval" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the fit function along the axis taxis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>taxis</strong> (<em>ndarray</em><em>, </em><em>int</em>) – <dl class="field-list simple">
<dt class="field-odd">if ndarray<span class="colon">:</span></dt>
<dd class="field-odd"><p>the new axis coordinates along which we want to calculate the fit.</p>
</dd>
<dt class="field-even">if int<span class="colon">:</span></dt>
<dd class="field-even"><p>number of evenly spaced points along the t-axis along the fit</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>self</strong> – the fit function evaluated along the axis coordinates that were passed</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="pyspecdata.html#pyspecdata.nddata" title="pyspecdata.nddata">nddata</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_jacobian</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.fit" title="Link to this definition">¶</a></dt>
<dd><p>actually run the fit</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.function_string">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">function_string</span></span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.function_string" title="Link to this definition">¶</a></dt>
<dd><p>A property of the myfitclass class which stores a string
output of the functional form of the desired fit expression
provided in func:<cite>functional_form</cite> in LaTeX format</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.functional_form">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">functional_form</span></span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.functional_form" title="Link to this definition">¶</a></dt>
<dd><p>A property of the myfitclass class which is set by the user,
takes as input a sympy expression of the desired fit
expression</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.gen_indices">
<span class="sig-name descname"><span class="pre">gen_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">this_set</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">set_to</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.gen_indices" title="Link to this definition">¶</a></dt>
<dd><p>pass this this_set and this_set_to parameters, and it will return:
indices,values,mask
indices –&gt; gives the indices that are forced
values –&gt; the values they are forced to
mask –&gt; p[mask] are actually active in the fit</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.guess">
<span class="sig-name descname"><span class="pre">guess</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.guess" title="Link to this definition">¶</a></dt>
<dd><p>Old code that we are preserving here – provide the guess for our
parameters; by default, based on pseudoinverse</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.jacobian">
<span class="sig-name descname"><span class="pre">jacobian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.jacobian" title="Link to this definition">¶</a></dt>
<dd><p>cache the symbolic jacobian and/or use it to compute the numeric result</p>
<p>Note that, like residual, this is designed for use by lmfit, so that if you want to actually <em>see</em> the Jacobian, you need to pass something a bit more complicated, like this:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">jac</span> <span class="o">=</span> <span class="n">newfit</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">newfit</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">newfit</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>
</div>
<p>which assumes that I have run the fit, and so have access to the fit parameters, and gives the complex view for complex data (since in a complex fit, we use view to treat real an imaginary parts the same)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.latex">
<span class="sig-name descname"><span class="pre">latex</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.latex" title="Link to this definition">¶</a></dt>
<dd><p>show the latex string for the function, with all the symbols substituted by their values</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.output">
<span class="sig-name descname"><span class="pre">output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.output" title="Link to this definition">¶</a></dt>
<dd><p>give the fit value of a particular symbol, or a dictionary of all values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str</em><em> (</em><em>optional</em><em>)</em>) – name of the symbol.
If no name is passed, then output returns a dictionary of the
resulting values.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>retval</strong> – Either a dictionary of all the values, or the value itself</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict or float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.pinvr_step">
<span class="sig-name descname"><span class="pre">pinvr_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.pinvr_step" title="Link to this definition">¶</a></dt>
<dd><p>Use regularized Pseudo-inverse to (partly) solve:
<span class="math notranslate nohighlight">\(-residual = f(\mathbf{p}+\Delta \mathbf{p})-f(\mathbf{p}) \approx \nabla f(\mathbf{p}) \cdot \Delta \mathbf{p}\)</span></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.residual">
<span class="sig-name descname"><span class="pre">residual</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.residual" title="Link to this definition">¶</a></dt>
<dd><p>calculate the residual OR if data is None, return fake data</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.set_guess">
<span class="sig-name descname"><span class="pre">set_guess</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.set_guess" title="Link to this definition">¶</a></dt>
<dd><p>set both the guess and the bounds</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>guesses</strong> (<em>dict</em><em> of </em><em>dicts</em>) – <p>each dict has a keyword giving the parameter and a value
that comprises a dict with guesses (value) and/or constraints
(min/max)</p>
<p>Can be passed either as the only argument, or a kwarg called
guesses, or as the kwargs themselves (i.e. <cite>.set_guesses(**guesses)</cite>)</p>
<p>For example (the last case:)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">set_guess</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">param1</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">param2</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.settoguess">
<span class="sig-name descname"><span class="pre">settoguess</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.settoguess" title="Link to this definition">¶</a></dt>
<dd><p>a debugging function, to easily plot the initial guess</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyspecdata.lmfitdata.lmfitdata.transformed_data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transformed_data</span></span><a class="headerlink" href="#pyspecdata.lmfitdata.lmfitdata.transformed_data" title="Link to this definition">¶</a></dt>
<dd><p>If we do something like fit a lorentzian or voigt lineshape,
it makes more sense to define our fit function in the time domain,
but to calculate the residuals and to evaluate in the frequency
domain.
Therefore, we define a function <cite>self.residual_transform</cite> that
accepts an nddata, and defines how the data is manipulated to move
into the (e.g. frequency) residual domain.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>retval</strong> – just return the ndarray</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/pyspec_path_equaltip.png" alt="Logo" />
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="nddata.html">ND-Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">the lmfitdata class</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pyspecdata.lmfitdata.lmfitdata"><code class="docutils literal notranslate"><span class="pre">lmfitdata</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">List of Modules and Sub-Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebook.html">LaTeX Notebook Functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="figlist.html">The Figure List</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="auto_examples/index.html">PySpecData Examples</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="fourier.html" title="previous chapter">Fourier Functions</a></li>
      <li>Next: <a href="modules.html" title="next chapter">List of Modules and Sub-Packages</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2016, John M. Franck.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/fitdata.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>